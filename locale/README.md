Localization
============

This folder contains application localization files :

- `messages.xlf` list of application messages that need to be translated (generated by angular 2 compiler)
- `messages.[language].xlf` translated version of `messages.xlf` for specific `[language]`


Adding a new language translation
---------------------------------

Copy `messages.xlf` to `messages.[language].xlf` where `[language]` is a language code of the language
you are translating to.

Use one of the [xliff editors](https://en.wikipedia.org/wiki/XLIFF#Editors) or edit the source file manually.

### Editing the xliff file manually

- open the `messages.[language].xlf` file in a text editor
  (eg. `messages.h.xlf` for Croatian)
- on `<file>` tag add a `target-lang="[language-culture]"` attribute where `[language-culture]` matches a language-culture code
  from a [well-known codeset](https://msdn.microsoft.com/en-us/library/ee825488(v=cs.20).aspx)
  (eg. `<file ... target-lang="HR-HR"> ...` for Croatian)
- for each `<trans-unit>` element add a `<target state="translated">[translation]</target>` where
  `[translation]` is the translated version of the text provided in `<source>` tag within the same `<trans-unit>`


Compiling the app with a specific language
------------------------------------------

Providing two environment variables :

- `LOCALE_ID` - [language culture code](https://www.youtube.com/watch?v=Aatp5gCskvk)
- `TRANSLATION_FILE` - translation file path (relative to `locale` folder)

### Dev build - JIT compilation

`webpack.config.js` will check if `TRANSLATION_FILE` and `LOCALE_ID` are both defined and
pass them to app using webpack `DefinePlugin` in `process.env`.

`main.browser.ts` will then use those variables to `require` the `TRANSLATION_FILE` and pass
it to bootstrap method along with `LOCALE_ID` and `xlf` as `TRANSLATION_FORMAT`.

### Production build - AOT compilation

`build:prod` task will invoke template AOT compilation trough `ngc:localized` script
which will read `LOCALE_ID` and `TRANSLATION_FILE` environment variables and if they are both
present it will pass them to `ngc` as `--i18nFile=TRANSLATION_FILE`, `--locale=LOCALE_ID` and
`--i18nFormat` will always be `xlf`.


Updating the source translation file
------------------------------------

You can generate the translation file from templates by using `npm run build:translation`,
this will generate `build/aot/messages.xlf` translation source containing translation source for
all angular app template elements that have `i18n` tag on them.


### Updating existing translations

WIP !

We need to figure out how to merge a new source `messages.xlf` file with existing translation
containing translations for an older version of the source.